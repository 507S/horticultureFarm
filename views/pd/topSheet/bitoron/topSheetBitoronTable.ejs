<%if (records.length >0){ %>
    <table class="table table-bordered table-striped" id="tblexportData" cellspacing="0" cellpadding="0">
        <thead>
        <tr>
            <th>আইটেমের নাম</th>
            <th>গত মাস পর্যন্ত উৎপাদন (সংখ্যা/প্যাকেট)</th>
            <th>চলতি মাসে উতপাদন(সংখ্যা/প্যাকেট)</th>
            <th>আলোচ্য মাস পর্যন্ত মোট উৎপাদন (সংখ্যা/প্যাকেট)</th>
        </tr>
        </thead>
        <tbody>
        <% cropCatg.forEach(function(row,index){ %>
            <%
                const currentMonth = moment().format("MMM-YYYY").toLowerCase();
                var totalProductionTarget = 0;
                var currentBitoronSum = 0;
                var previousMonthBitoron = 0;
                var totalProduction = 0;
                var productionTargetSum = 0;

                var startRange = "";
                var endRange = "";

                if (moment().format("M") < 7){
                    startRange = "jul"+"-"+moment().subtract(1, "year").format('yyyy')
                    endRange = "jul"+"-"+moment().format('yyyy')
                }else{
                    startRange = "jul"+"-"+moment().format('yyyy')
                    endRange = "jul"+"-"+moment().add(1, "year").format('yyyy')
                }

                records.forEach((monthProg) => {
                    if (monthProg.subCategory === row.name){

                        // উৎপাদন (লক্ষ্যমাত্রা) *********

                        const TargetProduction = JSON.parse(monthProg.productionTarget)
                        TargetProduction.forEach(function(prodTarget){
                            if ( moment(currentMonth).isAfter(prodTarget.startTime) &&  moment(currentMonth).isBefore(prodTarget.endTime) ){
                                productionTargetSum += parseInt(prodTarget.amount)
                            }
                        })

                        // total lokkhomatra in this economic year
                        totalProductionTarget += parseInt(monthProg.productionTarget)

                        //total purbo month porjonto production
                        const currentBitoron = JSON.parse(monthProg.bitoronCurrentMonth)
                        currentBitoron.forEach(function(bitoronCurrent){
                            if ( bitoronCurrent.time === moment().format("MMM-YYYY").toLowerCase() ) {
                                currentBitoronSum += parseInt(bitoronCurrent.amount)
                            }
                            else if ( moment( bitoronCurrent.time ).isAfter(startRange) &&  moment( bitoronCurrent.time ).isBefore(endRange) ){
                                previousMonthBitoron += parseInt(bitoronCurrent.amount)
                            }
                        })
                    }

                })
            %>
            <tr>
                <td><%= row.name %></td>
                <td><%= new Number(previousMonthBitoron).toLocaleString("bn-BD") %></td>
                <td><%= new Number(currentBitoronSum).toLocaleString("bn-BD") %></td>
                <td><%= new Number(currentBitoronSum + previousMonthBitoron).toLocaleString("bn-BD") %></td>
            </tr>
        <% }) %>
        </tbody>
    </table>
<% }else{ %>
    <table class="table table-bordered table-striped" id="tblCustomers" cellspacing="0" cellpadding="0">
        <thead>
        <tr>
            <th> আইটেমের নাম </th>
            <th> গত মাস পর্যন্ত উৎপাদন (সংখ্যা/প্যাকেট)</th>
            <th>চলতি মাসে উতপাদন(সংখ্যা/প্যাকেট)</th>
            <th>আলোচ্য মাস পর্যন্ত মোট উৎপাদন (সংখ্যা/প্যাকেট)</th>
            <th>পরিবর্তন/মুছুন</th>
        </tr>
        </thead>
        <tbody>
        <% records.forEach(function(row){ %>
            <tr>
                <td colspan="10">No data Found</td>
            </tr>
        <% }) %>
        </tbody>
    </table>
<% } %>